<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>2.0 Mini App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script async src="https://telegram.org/js/telegram-web-app.js" id="telegram-script"></script>
  <style>
    html{scroll-behavior:smooth}
    body{background:#000}
    .rotating-border{position:relative;display:inline-flex;align-items:center;justify-content:center}
    .rotating-border::before{content:'';position:absolute;top:-4px;left:-4px;right:-4px;bottom:-4px;border-radius:50%;background:linear-gradient(90deg,#fff,transparent);animation:rotateBorder 2s linear infinite;z-index:-1}
    @keyframes rotateBorder{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    .zoom-animation{animation:zoomInOut 3s ease-in-out 2}
    @keyframes zoomInOut{0%{transform:scale(1)}50%{transform:scale(1.5)}100%{transform:scale(1)}}
    .cylindrical-button{position:relative;display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:linear-gradient(145deg,#555,#333);box-shadow:inset 0 2px 4px rgba(0,0,0,0.5),inset 0 -2px 4px rgba(255,255,255,0.2)}
    .ziz-zizz-circle{position:relative;display:inline-block}
    .ziz-zizz-circle::before{content:'';position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;border-radius:50%;border:2px dashed currentColor;animation:rotateZizZizz 3s linear infinite,pulseZizZizz 0.5s ease-in-out infinite alternate;z-index:-1}
    @keyframes rotateZizZizz{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    @keyframes pulseZizZizz{from{transform:scale(1)}to{transform:scale(1.1)}}
  </style>
</head>
<body>
  <div id="app"></div>
  <div id="error" class="hidden text-red-500 text-center p-4">
    <span id="error-message"></span>
    <button onclick="window.location.reload()" className="ml-2 bg-gray-300 text-black px-2 py-1 rounded">Retry</button>
  </div>
  <div id="success" class="hidden text-green-500 text-center p-4">
    <span id="success-message"></span>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" onerror="showError('Failed to load XLSX library.')"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" onerror="showError('Failed to load React.')"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" onerror="showError('Failed to load ReactDOM.')"></script>
  <script>
    const TELEGRAM_SCRIPT_URLS = [
      'https://telegram.org/js/telegram-web-app.js',
      'https://cdn.jsdelivr.net/npm/@telegram-apps/telegram-web-app@2.2.1/telegram-web-app.min.js'
    ];
    let currentScriptIndex = 0;

    function loadTelegramScript(onSuccess, onError) {
      if (currentScriptIndex >= TELEGRAM_SCRIPT_URLS.length) {
        onError('All Telegram Web App script sources failed to load.');
        return;
      }
      const script = document.createElement('script');
      script.src = TELEGRAM_SCRIPT_URLS[currentScriptIndex];
      script.async = true;
      script.onload = () => {
        if (window.Telegram) {
          onSuccess();
        } else {
          currentScriptIndex++;
          loadTelegramScript(onSuccess, onError);
        }
      };
      script.onerror = () => {
        currentScriptIndex++;
        loadTelegramScript(onSuccess, onError);
      };
      document.head.appendChild(script);
    }

    function showError(message) {
      const errorDiv = document.getElementById('error');
      if (errorDiv) {
        document.getElementById('error-message').innerText = message;
        errorDiv.classList.remove('hidden');
        console.error('Error:', message);
      }
    }

    function showSuccess(message) {
      const successDiv = document.getElementById('success');
      if (successDiv) {
        document.getElementById('success-message').innerText = message;
        successDiv.classList.remove('hidden');
        setTimeout(() => {
          successDiv.classList.add('hidden');
          document.getElementById('success-message').innerText = '';
        }, 3000);
      }
    }

    const safeLocalStorage = {
      getItem(key, defaultValue) {
        try {
          const value = localStorage.getItem(key);
          if (value === null) return defaultValue;
          const parsed = JSON.parse(value);
          return key === 'referredUsers' && !Array.isArray(parsed) ? defaultValue : parsed;
        } catch (e) {
          return defaultValue;
        }
      },
      setItem(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {}
      }
    };

    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function sanitizeInitData(initData) {
      if (!initData || typeof initData !== 'object') throw new Error('Invalid Telegram user data');
      const { username, id } = initData;
      const safeId = (typeof id === 'string' || typeof id === 'number') && String(id).trim() ? String(id).replace(/[<>&]/g, '') : generateUUID();
      return {
        username: typeof username === 'string' ? username.replace(/[<>&]/g, '') : 'User',
        id: safeId
      };
    }

    const BOT_LINK = 'https://t.me/Twopoint0_bot';
    const CHANNEL_LINK = 'https://t.me/kingcrypto_real';
  </script>
  <script>
    const { useState, useEffect, Component } = React;

    class ErrorBoundary extends Component {
      state = { hasError: false, error: null };
      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }
      render() {
        if (this.state.hasError) {
          return React.createElement(
            'div',
            { className: 'text-red-500 text-center p-4' },
            React.createElement('p', null, 'Something went wrong: ', this.state.error.message),
            React.createElement(
              'button',
              { onClick: () => window.location.reload(), className: 'bg-gray-300 text-black px-2 py-1 rounded' },
              'Retry'
            )
          );
        }
        return this.props.children;
      }
    }

    function IntroScreen({ onComplete }) {
      useEffect(() => {
        const timer = setTimeout(() => {
          safeLocalStorage.setItem('introShown', 'true');
          onComplete();
        }, 3000);
        return () => clearTimeout(timer);
      }, [onComplete]);
      return React.createElement(
        'div',
        { className: 'min-h-screen bg-black flex items-center justify-center' },
        React.createElement('h1', { className: 'text-6xl font-bold text-white zoom-animation' }, '2.0')
      );
    }

    function AirdropCriteriaModal({
      isOpen,
      onClose,
      onConnectWallet,
      onJoinChannel,
      onInviteFriend,
      walletConnected,
      joinChannelCompleted,
      inviteFriendCompleted
    }) {
      if (!isOpen) return null;
      return React.createElement(
        'div',
        { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50' },
        React.createElement(
          'div',
          { className: 'bg-[#181818] rounded-lg p-6 w-full max-w-md' },
          React.createElement(
            'div',
            { className: 'flex justify-between items-center mb-4' },
            React.createElement('h2', { className: 'text-xl font-bold text-white' }, 'Airdrop Criteria'),
            React.createElement(
              'button',
              { onClick: onClose, className: 'text-white', 'aria-label': 'Close airdrop criteria modal' },
              React.createElement('svg', {
                className: 'w-6 h-6',
                fill: 'none',
                stroke: 'currentColor',
                viewBox: '0 0 24 24',
                xmlns: 'http://www.w3.org/2000/svg'
              }, React.createElement('title', null, 'Close'), React.createElement('path', {
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
                strokeWidth: '2',
                d: 'M6 18L18 6M6 6l12 12'
              }))
            )
          ),
          React.createElement(
            'div',
            { className: 'space-y-4' },
            React.createElement(
              'div',
              { className: 'flex justify-between items-center p-2 bg-[#282828] rounded' },
              React.createElement('span', { className: 'text-white' }, 'Connect Wallet'),
              React.createElement(
                'button',
                {
                  onClick: onConnectWallet,
                  disabled: walletConnected,
                  className: `cylindrical-button ziz-zizz-circle p-2 ${walletConnected ? 'bg-[#181818]' : 'bg-white text-black'}`,
                  'aria-label': walletConnected ? 'Wallet connected' : 'Connect wallet'
                },
                walletConnected ? '☑️' : 'Go'
              )
            ),
            React.createElement(
              'div',
              { className: 'flex justify-between items-center p-2 bg-[#282828] rounded' },
              React.createElement('span', { className: 'text-white' }, 'Join 2.0$ Channel'),
              React.createElement(
                'button',
                {
                  onClick: onJoinChannel,
                  disabled: joinChannelCompleted,
                  className: `cylindrical-button ziz-zizz-circle p-2 ${joinChannelCompleted ? 'bg-[#181818]' : 'bg-white text-black'}`,
                  'aria-label': joinChannelCompleted ? 'Channel joined' : 'Join 2.0$ Channel'
                },
                joinChannelCompleted ? '☑️' : 'Go'
              )
            ),
            React.createElement(
              'div',
              { className: 'flex justify-between items-center p-2 bg-[#282828] rounded' },
              React.createElement('span', { className: 'text-white' }, 'Invite 1 Friend'),
              React.createElement(
                'button',
                {
                  onClick: onInviteFriend,
                  disabled: inviteFriendCompleted,
                  className: `cylindrical-button ziz-zizz-circle p-2 ${inviteFriendCompleted ? 'bg-[#181818]' : 'bg-white text-black'}`,
                  'aria-label': inviteFriendCompleted ? 'Friend invited' : 'Invite a friend'
                },
                inviteFriendCompleted ? '☑️' : 'Go'
              )
            )
          )
        )
      );
    }

    function TwoPointZeroApp() {
      const defaultTasks = [
        { id: 1, name: 'Join 2.0$ Channel', reward: 1000, completed: false },
        { id: 2, name: 'Follow on X', reward: 500, completed: false },
        { id: 3, name: 'Daily Check-In', reward: 200, completed: false }
      ];
      const [user, setUser] = useState(null);
      const [initializationError, setInitializationError] = useState(null);
      const [loading, setLoading] = useState(true);
      const [tokens, setTokens] = useState(() => safeLocalStorage.getItem('tokens', 0));
      const [chatCount, setChatCount] = useState(() => safeLocalStorage.getItem('chatCount', 0));
      const [tasks, setTasks] = useState(() => safeLocalStorage.getItem('tasks', defaultTasks));
      const [referralCount, setReferralCount] = useState(() => safeLocalStorage.getItem('referralCount', 0));
      const [referredUsers, setReferredUsers] = useState(() => safeLocalStorage.getItem('referredUsers', []));
      const [referralCommissions, setReferralCommissions] = useState(() => safeLocalStorage.getItem('referralCommissions', 0));
      const [walletConnected, setWalletConnected] = useState(() => safeLocalStorage.getItem('walletConnected', false));
      const [airdropClaimed, setAirdropClaimed] = useState(() => safeLocalStorage.getItem('airdropClaimed', false));
      const [activeTab, setActiveTab] = useState('home');
      const [showIntro, setShowIntro] = useState(() => !safeLocalStorage.getItem('introShown', false));
      const [showModal, setShowModal] = useState(false);

      useEffect(() => {
        const initializeTelegram = () => {
          try {
            if (window.Telegram && window.Telegram.WebApp) {
              window.Telegram.WebApp.ready();
              const initData = window.Telegram.WebApp.initDataUnsafe || {};
              if (!initData.user) {
                setInitializationError('No user data provided by Telegram. Please open in Telegram.');
                setLoading(false);
                return;
              }
              const sanitizedUser = sanitizeInitData(initData.user);
              setUser(sanitizedUser);
              window.Telegram.WebApp.expand();
              setLoading(false);
            } else {
              setInitializationError('Telegram Web App not detected. Please open in Telegram.');
              setLoading(false);
            }
          } catch (e) {
            console.error('Telegram initialization error:', e.message, e.stack);
            setInitializationError(`Error initializing Telegram Web App: ${e.message}. Please open in Telegram.`);
            setLoading(false);
          }
        };

        const pollForTelegram = (attempts, maxAttempts, interval) => {
          if (attempts >= maxAttempts) {
            setInitializationError('Failed to load Telegram Web App after multiple attempts. Please check your network or open in Telegram.');
            setLoading(false);
            return;
          }
          if (window.Telegram && window.Telegram.WebApp) {
            initializeTelegram();
          } else {
            setTimeout(() => pollForTelegram(attempts + 1, maxAttempts, interval), interval);
          }
        };

        if (window.Telegram && window.Telegram.WebApp) {
          initializeTelegram();
        } else {
          loadTelegramScript(
            () => pollForTelegram(0, 10, 500),
            (error) => {
              setInitializationError(error);
              setLoading(false);
            }
          );
        }

        return () => {};
      }, []);

      useEffect(() => {
        if (user && chatCount === 0) {
          try {
            const randomChats = Math.floor(Math.random() * 50) + 1;
            setChatCount(randomChats);
            setTokens(prev => prev + randomChats * 100);
          } catch (e) {
            console.error('Error setting chat count:', e);
          }
        }
      }, [user, chatCount]);

      useEffect(() => {
        if (user) {
          const timeout = setTimeout(() => {
            safeLocalStorage.setItem('tokens', Math.floor(tokens));
            safeLocalStorage.setItem('tasks', tasks);
            safeLocalStorage.setItem('referralCount', referralCount);
            safeLocalStorage.setItem('referredUsers', referredUsers);
            safeLocalStorage.setItem('referralCommissions', referralCommissions);
            safeLocalStorage.setItem('walletConnected', walletConnected);
            safeLocalStorage.setItem('airdropClaimed', airdropClaimed);
            safeLocalStorage.setItem('chatCount', chatCount);
          }, 500);
          return () => clearTimeout(timeout);
        }
      }, [user, tokens, tasks, referralCount, referredUsers, referralCommissions, walletConnected, airdropClaimed, chatCount]);

      const completeTask = taskId => {
        try {
          setTasks(prevTasks => prevTasks.map(task => task.id === taskId ? { ...task, completed: true } : task));
          const task = tasks.find(t => t.id === taskId);
          if (task && !task.completed) {
            setTokens(prev => prev + task.reward);
          }
        } catch (e) {
          showError('Failed to complete task. Please try again.');
        }
      };

      const handleJoinChannel = () => {
        try {
          if (window.Telegram?.WebApp?.openTelegramLink) {
            window.Telegram.WebApp.openTelegramLink(CHANNEL_LINK);
          } else {
            window.open(CHANNEL_LINK, '_blank');
          }
          completeTask(1);
        } catch (e) {
          showError('Failed to open channel. Please try again.');
        }
      };

      const addReferral = () => {
        try {
          setReferralCount(prev => prev + 1);
          const newReferralId = `ref_${referralCount + 1}_${Date.now()}`;
          const referralTokens = Math.floor(Math.random() * 5000) + 1000;
          const commission = Math.floor(referralTokens * 0.1);
          setReferredUsers(prev => [...prev, { id: newReferralId, tokens: referralTokens }]);
          setReferralCommissions(prev => prev + commission);
          setTokens(prev => prev + commission);
        } catch (e) {
          showError('Failed to add referral. Please try again.');
        }
      };

      const copyInviteLink = () => {
        try {
          const link = `${BOT_LINK}?start=ref_${user?.id || generateUUID()}`;
          if (!link.includes(BOT_LINK) || !link.includes('start=ref_')) {
            throw new Error('Invalid referral link');
          }
          navigator.clipboard.writeText(link).then(() => {
            showSuccess('Referral link copied');
          }).catch(() => {
            showError('Failed to copy referral link. Link: ' + link);
          });
        } catch (e) {
          showError('Failed to copy referral link. Please try again.');
        }
      };

      const connectWallet = () => {
        try {
          setWalletConnected(true);
          setTokens(prev => prev + 1000);
          if (window.Telegram?.WebApp?.showAlert) {
            window.Telegram.WebApp.showAlert('Simulated TON wallet connected!');
          } else {
            alert('Simulated TON wallet connected!');
          }
        } catch (e) {
          showError('Failed to connect wallet. Please try again.');
        }
      };

      const handleAirdrop = () => {
        try {
          if (airdropClaimed) {
            if (window.Telegram?.WebApp?.showAlert) {
              window.Telegram.WebApp.showAlert('Airdrop already claimed.');
            } else {
              alert('Airdrop already claimed.');
            }
            return;
          }
          if (!Array.isArray(tasks) || tasks.length === 0) {
            showError('Tasks data is invalid. Please clear localStorage and try again.');
            return;
          }
          const joinChannelTask = tasks.find(task => task.id === 1);
          const joinChannelCompleted = joinChannelTask ? joinChannelTask.completed : false;
          const inviteFriendCompleted = referralCount > 0;
          const criteriaMet = walletConnected && joinChannelCompleted && inviteFriendCompleted;
          if (criteriaMet) {
            setTokens(prev => prev + 5000);
            setAirdropClaimed(true);
            if (window.Telegram?.WebApp?.showAlert) {
              window.Telegram.WebApp.showAlert('Airdrop claimed! +5000 $2.0');
            } else {
              alert('Airdrop claimed! +5000 $2.0');
            }
          } else {
            const unmetCriteria = [];
            if (!walletConnected) unmetCriteria.push('Connect Wallet');
            if (!joinChannelCompleted) unmetCriteria.push('Join 2.0$ Channel');
            if (!inviteFriendCompleted) unmetCriteria.push('Invite 1 Friend');
            const message = `Please complete: ${unmetCriteria.join(', ')}.`;
            if (window.Telegram?.WebApp?.showAlert) {
              window.Telegram.WebApp.showAlert(message);
            } else {
              alert(message);
            }
          }
        } catch (e) {
          showError('Failed to process airdrop. Please try again.');
        }
      };

      const retryInitialization = () => {
        setLoading(true);
        setInitializationError(null);
        currentScriptIndex = 0;
        loadTelegramScript(
          () => pollForTelegram(0, 10, 500),
          (error) => {
            setInitializationError(error);
            setLoading(false);
          }
        );
      };

      const toggleModal = () => setShowModal(prev => !prev);
      const joinChannelCompleted = tasks.find(task => task.id === 1)?.completed || false;
      const inviteFriendCompleted = referralCount > 0;

      if (initializationError) {
        return React.createElement(
          'div',
          { className: 'min-h-screen bg-black flex items-center justify-center' },
          React.createElement(
            'div',
            { className: 'text-red-500 text-center p-4' },
            React.createElement('p', null, initializationError),
            React.createElement(
              'div',
              { className: 'mt-4 flex space-x-2 justify-center' },
              React.createElement(
                'button',
                { onClick: retryInitialization, className: 'bg-gray-300 text-black px-4 py-2 rounded' },
                'Retry'
              ),
              React.createElement(
                'a',
                { href: BOT_LINK, className: 'bg-blue-500 text-white px-4 py-2 rounded', target: '_blank', rel: 'noopener noreferrer' },
                'Open in Telegram'
              )
            )
          )
        );
      }

      if (loading) {
        return React.createElement(
          'div',
          { className: 'min-h-screen bg-black flex items-center justify-center' },
          React.createElement('p', { className: 'text-white text-center' }, 'Loading...')
        );
      }

      if (!user) {
        return null;
      }

      if (showIntro) {
        return React.createElement(IntroScreen, { onComplete: () => setShowIntro(false) });
      }

      return React.createElement(
        'div',
        { className: 'min-h-screen text-white flex flex-col items-center p-4 pb-16' },
        React.createElement(
          'div',
          { className: 'flex justify-center mb-4' },
          React.createElement(
            'div',
            { className: 'rotating-border' },
            React.createElement(
              'div',
              { className: 'bg-black rounded-full w-28 h-28 flex items-center justify-center text-center shadow-lg' },
              React.createElement(
                'div',
                null,
                React.createElement('p', { className: 'text-lg font-bold text-white' }, Math.floor(tokens)),
                React.createElement('p', { className: 'text-sm text-white' }, '$2.0')
              )
            )
          )
        ),
        React.createElement(
          'div',
          { className: 'w-full max-w-md flex justify-between items-center mt-4 mb-4' },
          React.createElement(
            'div',
            { className: 'flex items-center' },
            React.createElement('h1', { className: 'text-xl font-bold' })
          ),
          React.createElement(
            'div',
            { className: 'flex space-x-3' },
            React.createElement(
              'button',
              { onClick: copyInviteLink, className: 'text-white', title: 'Copy Invite Link', 'aria-label': 'Copy invite link' },
              React.createElement('svg', {
                className: 'w-6 h-6',
                fill: 'none',
                stroke: 'currentColor',
                viewBox: '0 0 24 24',
                xmlns: 'http://www.w3.org/2000/svg'
              }, React.createElement('title', null, 'Copy'), React.createElement('path', {
                strokeLinecap: 'round',
                strokeLinejoin: 'round',
                strokeWidth: '2',
                d: 'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z'
              }))
            ),
            React.createElement(
              'button',
              {
                onClick: toggleModal,
                className: 'bg-gray-300 text-black px-3 py-1 rounded text-sm font-medium hover:bg-gray-400 transition',
                title: 'Airdrop Criteria',
                'aria-label': 'Open airdrop criteria modal'
              },
              'Airdrop Criteria'
            )
          )
        ),
        React.createElement(AirdropCriteriaModal, {
          isOpen: showModal,
          onClose: toggleModal,
          onConnectWallet: connectWallet,
          onJoinChannel: handleJoinChannel,
          onInviteFriend: copyInviteLink,
          walletConnected,
          joinChannelCompleted,
          inviteFriendCompleted
        }),
        React.createElement(
          'div',
          { className: 'w-full max-w-md bg-[#181818] rounded-lg p-4 mb-4' },
          React.createElement('p', null, `Chats: ${chatCount} | Referrals: ${referralCount} | Commissions: ${referralCommissions} $2.0`)
        ),
        React.createElement(
          'div',
          { className: 'w-full max-w-md' },
          activeTab === 'home' && React.createElement(
            'div',
            { className: 'bg-black rounded-lg p-4' },
            React.createElement('h3', { className: 'text-lg font-bold mb-2' }),
            React.createElement('button', { onClick: copyInviteLink }),
            React.createElement(
              'div',
              { className: 'mt-4' },
              React.createElement('h4', { className: 'text-lg font-bold mb-2' }, 'Tasks'),
              tasks.map(task => React.createElement(
                'div',
                { key: task.id, className: 'flex justify-between items-center p-2 bg-[#181818] rounded mb-2' },
                React.createElement('span', null, `${task.name} (+${task.reward} $2.0)`),
                task.id === 1 ? React.createElement(
                  'button',
                  {
                    onClick: handleJoinChannel,
                    disabled: task.completed,
                    className: `px-4 py-1 rounded ${task.completed ? 'bg-[#181818]' : 'bg-white'} text-black`,
                    'aria-label': task.completed ? `${task.name} completed` : `Complete ${task.name}`
                  },
                  task.completed ? '☑️' : 'Go'
                ) : React.createElement(
                  'button',
                  {
                    onClick: () => completeTask(task.id),
                    disabled: task.completed,
                    className: `px-4 py-1 rounded ${task.completed ? 'bg-[#181818]' : 'bg-white'} text-black`,
                    'aria-label': task.completed ? `${task.name} completed` : `Complete ${task.name}`
                  },
                  task.completed ? '☑️' : 'Go'
                )
              ))
            )
          ),
          activeTab === 'referrals' && React.createElement(
            'div',
            { className: 'bg-[#181818] rounded-lg p-4' },
            React.createElement('h3', { className: 'text-lg font-bold mb-2' }, 'Referrals'),
            React.createElement('p', null, 'Invite friends to earn 10% of their $2.0 tokens!'),
            React.createElement('p', null, `Referral Count: ${referralCount}`),
            React.createElement('p', null, `Total Commissions: ${referralCommissions} $2.0`),
            referredUsers.length > 0 && Array.isArray(referredUsers) ? React.createElement(
              'div',
              { className: 'mt-4' },
              React.createElement('h4', { className: 'text-md font-bold mb-2' }, 'Referred Users'),
              referredUsers.filter(user => user && typeof user === 'object' && user.id && typeof user.tokens === 'number').map(user => React.createElement(
                'div',
                { key: user.id, className: 'p-2 bg-[#282828] rounded mb-2' },
                React.createElement('span', null, `User ${user.id}: ${user.tokens} $2.0`)
              ))
            ) : null,
            React.createElement(
              'button',
              { onClick: copyInviteLink, className: 'mt-4 bg-gray-300 text-black px-4 py-2 rounded', 'aria-label': 'Copy invite link' },
              'Copy Invite Link'
            ),
            React.createElement(
              'button',
              { onClick: addReferral, className: 'mt-2 bg-gray-500 text-white px-4 py-2 rounded', 'aria-label': 'Test add referral' },
              'Add Referral (Test)'
            )
          ),
          activeTab === 'wallet' && React.createElement(
            'div',
            { className: 'bg-[#181818] rounded-lg p-4' },
            React.createElement('h3', { className: 'text-lg font-bold mb-2' }, 'Wallet'),
            walletConnected ? React.createElement('p', null, 'TON Wallet Connected!') : React.createElement(
              'button',
              { onClick: connectWallet, className: 'bg-gray-300 text-black px-4 py-2 rounded', 'aria-label': 'Connect TON wallet' },
              'Connect TON Wallet'
            )
          )
        ),
        React.createElement(
          'div',
          { className: 'fixed bottom-0 left-0 right-0 bg-[#181818] p-2 flex justify-around w-full max-w-md mx-auto' },
          React.createElement(
            'button',
            {
              className: `p-2 rounded ${activeTab === 'referrals' ? 'bg-black text-black' : 'text-white'}`,
              onClick: () => setActiveTab('referrals'),
              title: 'Referrals',
              'aria-label': 'Navigate to Referrals tab',
              'aria-selected': activeTab === 'referrals'
            },
            React.createElement(
              'span',
              { className: 'cylindrical-button ziz-zizz-circle' },
              React.createElement('svg', {
                className: 'w-6 h-6',
                fill: 'currentColor',
                viewBox: '0 0 24 24',
                xmlns: 'http://www.w3.org/2000/svg'
              }, React.createElement('title', null, 'Referrals'), React.createElement('path', {
                d: 'M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z'
              }))
            )
          ),
          React.createElement(
            'button',
            {
              className: `p-2 rounded ${activeTab === 'home' ? 'bg-black text-black' : 'text-white'}`,
              onClick: () => setActiveTab('home'),
              title: 'Home',
              'aria-label': 'Navigate to Home tab',
              'aria-selected': activeTab === 'home'
            },
            React.createElement(
              'span',
              { className: 'cylindrical-button ziz-zizz-circle' },
              React.createElement('svg', {
                className: 'w-6 h-6',
                fill: 'currentColor',
                viewBox: '0 0 24 24',
                xmlns: 'http://www.w3.org/2000/svg'
              }, React.createElement('title', null, 'Home'), React.createElement('circle', {
                cx: '12',
                cy: '12',
                r: '10',
                fill: 'none',
                stroke: 'currentColor',
                strokeWidth: '1'
              }), React.createElement('circle', { cx: '12', cy: '6', r: '2' }), React.createElement('circle', { cx: '12', cy: '12', r: '2' }), React.createElement('circle', { cx: '12', cy: '18', r: '2' }))
            )
          ),
          React.createElement(
            'button',
            {
              className: `p-2 rounded ${activeTab === 'wallet' ? 'bg-black text-black' : 'text-white'}`,
              onClick: () => setActiveTab('wallet'),
              title: 'Wallet',
              'aria-label': 'Navigate to Wallet tab',
              'aria-selected': activeTab === 'wallet'
            },
            React.createElement(
              'span',
              { className: 'cylindrical-button ziz-zizz-circle' },
              React.createElement('svg', {
                className: 'w-6 h-6',
                fill: 'currentColor',
                viewBox: '0 0 24 24',
                xmlns: 'http://www.w3.org/2000/svg'
              }, React.createElement('title', null, 'Wallet'), React.createElement('path', {
                d: 'M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z'
              }))
            )
          )
        )
      );
    }

    try {
      if (window.React && window.ReactDOM && document.getElementById('app')) {
        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(
          React.createElement(
            ErrorBoundary,
            null,
            React.createElement(TwoPointZeroApp, null)
          )
        );
      } else {
        showError('Failed to load required libraries (React, ReactDOM) or app container not found.');
      }
    } catch (e) {
      showError('Failed to initialize app.');
    }
  </script>
</body>
</html>
