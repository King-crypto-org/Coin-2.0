<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin 2.0 Telegram Mini App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: white;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .points {
            background-color: #333;
            border-radius: 50%;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px;
            font-size: 24px;
        }
        .stats, .tasks {
            background-color: #2a2a2a;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .task {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #3a3a3a;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        button {
            background-color: #007bff;
            border: none;
            padding: 10px 20px;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <div class="points" id="pointsDisplay">
            <div id="totalPoints">0</div>
            <div id="tokenValue">$0.0</div>
        </div>

        <button id="airdropButton" onclick="checkAirdropCriteria()">Airdrop Criteria</button>
        <button id="referButton" onclick="generateReferralLink()">Refer a Friend</button>

        <div class="stats">
            <span>Chats: <span id="chatCount">0</span> | </span>
            <span>Referrals: <span id="referralCount">0</span> | </span>
            <span>Commissions: <span id="commissionPoints">0</span> ($<span id="commissionValue">0.0</span>)</span>
        </div>

        <h2>Tasks</h2>
        <div class="tasks" id="taskList">
            <div class="task">
                <span>Join PUPPYS Channel (+500 $2.0)</span>
                <button id="joinChannelBtn" onclick="completeTask('joinChannel')">Go</button>
            </div>
            <div class="task">
                <span>Follow on X (+1000 $2.0)</span>
                <button id="followXBtn" onclick="completeTask('followX')">Go</button>
            </div>
            <div class="task">
                <span>Daily Check-In (+200 $2.0)</span>
                <button id="checkInBtn" onclick="completeTask('dailyCheckIn')">Go</button>
            </div>
        </div>
    </div>

    <script>
        const TelegramWebApp = window.Telegram.WebApp;
        TelegramWebApp.ready();

        let userData = TelegramWebApp.initDataUnsafe.user || {};
        let totalPoints = 0;
        let tokenValue = 0.0;
        let chatCount = 0;
        let referralCount = 0;
        let commissionPoints = 0;
        let commissionValue = 0.0;
        let referredUsers = []; // Track referred users and their points

        let tasksCompleted = {
            joinChannel: false,
            followX: false,
            dailyCheckIn: false
        };

        const pointsDisplay = document.getElementById('totalPoints');
        const tokenValueDisplay = document.getElementById('tokenValue');
        const chatCountDisplay = document.getElementById('chatCount');
        const referralCountDisplay = document.getElementById('referralCount');
        const commissionPointsDisplay = document.getElementById('commissionPoints');
        const commissionValueDisplay = document.getElementById('commissionValue');

        function updateDisplay() {
            pointsDisplay.textContent = totalPoints;
            tokenValueDisplay.textContent = `$${tokenValue.toFixed(1)}`;
            chatCountDisplay.textContent = chatCount;
            referralCountDisplay.textContent = referralCount;
            commissionPointsDisplay.textContent = commissionPoints;
            commissionValueDisplay.textContent = commissionValue.toFixed(1);
        }

        function generateReferralLink() {
            const userId = userData.id || 'demo_user';
            const referralLink = `https://t.me/Twopoint0_bot?start=ref_${userId}`;
            TelegramWebApp.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=Join Coin 2.0 and earn Crypto 2.0 tokens!`);
        }

        function completeTask(taskName) {
            if (tasksCompleted[taskName]) return;

            let pointsToAdd = 0;
            if (taskName === 'joinChannel') {
                TelegramWebApp.openTelegramLink('https://t.me/puppys_channel');
                pointsToAdd = 500;
            } else if (taskName === 'followX') {
                TelegramWebApp.openLink('https://x.com/coin2_0');
                pointsToAdd = 1000;
            } else if (taskName === 'dailyCheckIn') {
                pointsToAdd = 200;
            }

            totalPoints += pointsToAdd;
            tokenValue = totalPoints / 5000;
            tasksCompleted[taskName] = true;
            document.getElementById(`${taskName}Btn`).textContent = 'âœ”';
            document.getElementById(`${taskName}Btn`).disabled = true;
            updateDisplay();

            // Update referred users' points and calculate commissions
            referredUsers.forEach(user => {
                user.points += pointsToAdd;
                const commission = pointsToAdd * 0.1; // 10% commission
                commissionPoints += commission;
                commissionValue = commissionPoints / 5000;
            });
            updateDisplay();
        }

        function checkAirdropCriteria() {
            let criteriaMet = true;
            let message = "Airdrop Criteria:\n";

            if (!tasksCompleted.joinChannel) {
                criteriaMet = false;
                message += "- Join PUPPYS Channel: Not completed\n";
            } else {
                message += "- Join PUPPYS Channel: Completed\n";
            }

            if (referralCount < 1) {
                criteriaMet = false;
                message += "- Invite at least 1 friend: Not completed\n";
            } else {
                message += "- Invite at least 1 friend: Completed\n";
            }

            message += "- Connect TON Wallet: Not implemented in this demo\n";

            if (criteriaMet) {
                message += "\nAll criteria met! You're eligible for the airdrop.";
            } else {
                message += "\nComplete all criteria to be eligible for the airdrop.";
            }

            TelegramWebApp.showAlert(message);
        }

        function simulateMining() {
            setInterval(() => {
                totalPoints += 10;
                tokenValue = totalPoints / 5000;
                updateDisplay();

                // Update referred users' points and calculate commissions
                referredUsers.forEach(user => {
                    user.points += 10;
                    const commission = 10 * 0.1; // 10% commission
                    commissionPoints += commission;
                    commissionValue = commissionPoints / 5000;
                });
                updateDisplay();
            }, 60000);
        }

        function simulateChatActivity() {
            setInterval(() => {
                chatCount++;
                updateDisplay();
            }, 300000);
        }

        function simulateReferrals() {
            setInterval(() => {
                if (Math.random() > 0.7) {
                    referralCount++;
                    referredUsers.push({ id: `user_${referralCount}`, points: 0 });
                    updateDisplay();
                }
            }, 600000);
        }

        simulateMining();
        simulateChatActivity();
        simulateReferrals();
    </script>
</body>
</html>
